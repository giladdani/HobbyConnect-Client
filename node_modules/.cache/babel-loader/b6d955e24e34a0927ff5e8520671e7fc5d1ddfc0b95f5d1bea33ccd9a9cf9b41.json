{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ValidateCollectionOperation = void 0;\nconst command_1 = require(\"./command\");\nconst error_1 = require(\"../error\");\n/** @internal */\nclass ValidateCollectionOperation extends command_1.CommandOperation {\n  constructor(admin, collectionName, options) {\n    // Decorate command with extra options\n    const command = {\n      validate: collectionName\n    };\n    const keys = Object.keys(options);\n    for (let i = 0; i < keys.length; i++) {\n      if (Object.prototype.hasOwnProperty.call(options, keys[i]) && keys[i] !== 'session') {\n        command[keys[i]] = options[keys[i]];\n      }\n    }\n    super(admin.s.db, options);\n    this.options = options;\n    this.command = command;\n    this.collectionName = collectionName;\n  }\n  execute(server, session, callback) {\n    const collectionName = this.collectionName;\n    super.executeCommand(server, session, this.command, (err, doc) => {\n      if (err != null) return callback(err);\n      // TODO(NODE-3483): Replace these with MongoUnexpectedServerResponseError\n      if (doc.ok === 0) return callback(new error_1.MongoRuntimeError('Error with validate command'));\n      if (doc.result != null && typeof doc.result !== 'string') return callback(new error_1.MongoRuntimeError('Error with validation data'));\n      if (doc.result != null && doc.result.match(/exception|corrupt/) != null) return callback(new error_1.MongoRuntimeError(`Invalid collection ${collectionName}`));\n      if (doc.valid != null && !doc.valid) return callback(new error_1.MongoRuntimeError(`Invalid collection ${collectionName}`));\n      return callback(undefined, doc);\n    });\n  }\n}\nexports.ValidateCollectionOperation = ValidateCollectionOperation;","map":{"version":3,"mappings":";;;;;;AAAA;AAMA;AAQA;AACA,MAAaA,2BAA4B,SAAQC,0BAA0B;EAKzEC,YAAYC,KAAY,EAAEC,cAAsB,EAAEC,OAAkC;IAClF;IACA,MAAMC,OAAO,GAAa;MAAEC,QAAQ,EAAEH;IAAc,CAAE;IACtD,MAAMI,IAAI,GAAGC,MAAM,CAACD,IAAI,CAACH,OAAO,CAAC;IACjC,KAAK,IAAIK,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,IAAI,CAACG,MAAM,EAAED,CAAC,EAAE,EAAE;MACpC,IAAID,MAAM,CAACG,SAAS,CAACC,cAAc,CAACC,IAAI,CAACT,OAAO,EAAEG,IAAI,CAACE,CAAC,CAAC,CAAC,IAAIF,IAAI,CAACE,CAAC,CAAC,KAAK,SAAS,EAAE;QACnFJ,OAAO,CAACE,IAAI,CAACE,CAAC,CAAC,CAAC,GAAIL,OAAoB,CAACG,IAAI,CAACE,CAAC,CAAC,CAAC;;;IAIrD,KAAK,CAACP,KAAK,CAACY,CAAC,CAACC,EAAE,EAAEX,OAAO,CAAC;IAC1B,IAAI,CAACA,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACF,cAAc,GAAGA,cAAc;EACtC;EAEAa,OAAO,CAACC,MAAc,EAAEC,OAAsB,EAAEC,QAA4B;IAC1E,MAAMhB,cAAc,GAAG,IAAI,CAACA,cAAc;IAE1C,KAAK,CAACiB,cAAc,CAACH,MAAM,EAAEC,OAAO,EAAE,IAAI,CAACb,OAAO,EAAE,CAACgB,GAAG,EAAEC,GAAG,KAAI;MAC/D,IAAID,GAAG,IAAI,IAAI,EAAE,OAAOF,QAAQ,CAACE,GAAG,CAAC;MAErC;MACA,IAAIC,GAAG,CAACC,EAAE,KAAK,CAAC,EAAE,OAAOJ,QAAQ,CAAC,IAAIK,yBAAiB,CAAC,6BAA6B,CAAC,CAAC;MACvF,IAAIF,GAAG,CAACG,MAAM,IAAI,IAAI,IAAI,OAAOH,GAAG,CAACG,MAAM,KAAK,QAAQ,EACtD,OAAON,QAAQ,CAAC,IAAIK,yBAAiB,CAAC,4BAA4B,CAAC,CAAC;MACtE,IAAIF,GAAG,CAACG,MAAM,IAAI,IAAI,IAAIH,GAAG,CAACG,MAAM,CAACC,KAAK,CAAC,mBAAmB,CAAC,IAAI,IAAI,EACrE,OAAOP,QAAQ,CAAC,IAAIK,yBAAiB,CAAC,sBAAsBrB,cAAc,EAAE,CAAC,CAAC;MAChF,IAAImB,GAAG,CAACK,KAAK,IAAI,IAAI,IAAI,CAACL,GAAG,CAACK,KAAK,EACjC,OAAOR,QAAQ,CAAC,IAAIK,yBAAiB,CAAC,sBAAsBrB,cAAc,EAAE,CAAC,CAAC;MAEhF,OAAOgB,QAAQ,CAACS,SAAS,EAAEN,GAAG,CAAC;IACjC,CAAC,CAAC;EACJ;;AAtCFO","names":["ValidateCollectionOperation","command_1","constructor","admin","collectionName","options","command","validate","keys","Object","i","length","prototype","hasOwnProperty","call","s","db","execute","server","session","callback","executeCommand","err","doc","ok","error_1","result","match","valid","undefined","exports"],"sources":["C:\\Users\\danin\\node_modules\\mongodb\\src\\operations\\validate_collection.ts"],"sourcesContent":["import { CommandOperation, CommandOperationOptions } from './command';\nimport type { Callback } from '../utils';\nimport type { Document } from '../bson';\nimport type { Server } from '../sdam/server';\nimport type { Admin } from '../admin';\nimport type { ClientSession } from '../sessions';\nimport { MongoRuntimeError } from '../error';\n\n/** @public */\nexport interface ValidateCollectionOptions extends CommandOperationOptions {\n  /** Validates a collection in the background, without interrupting read or write traffic (only in MongoDB 4.4+) */\n  background?: boolean;\n}\n\n/** @internal */\nexport class ValidateCollectionOperation extends CommandOperation<Document> {\n  options: ValidateCollectionOptions;\n  collectionName: string;\n  command: Document;\n\n  constructor(admin: Admin, collectionName: string, options: ValidateCollectionOptions) {\n    // Decorate command with extra options\n    const command: Document = { validate: collectionName };\n    const keys = Object.keys(options);\n    for (let i = 0; i < keys.length; i++) {\n      if (Object.prototype.hasOwnProperty.call(options, keys[i]) && keys[i] !== 'session') {\n        command[keys[i]] = (options as Document)[keys[i]];\n      }\n    }\n\n    super(admin.s.db, options);\n    this.options = options;\n    this.command = command;\n    this.collectionName = collectionName;\n  }\n\n  execute(server: Server, session: ClientSession, callback: Callback<Document>): void {\n    const collectionName = this.collectionName;\n\n    super.executeCommand(server, session, this.command, (err, doc) => {\n      if (err != null) return callback(err);\n\n      // TODO(NODE-3483): Replace these with MongoUnexpectedServerResponseError\n      if (doc.ok === 0) return callback(new MongoRuntimeError('Error with validate command'));\n      if (doc.result != null && typeof doc.result !== 'string')\n        return callback(new MongoRuntimeError('Error with validation data'));\n      if (doc.result != null && doc.result.match(/exception|corrupt/) != null)\n        return callback(new MongoRuntimeError(`Invalid collection ${collectionName}`));\n      if (doc.valid != null && !doc.valid)\n        return callback(new MongoRuntimeError(`Invalid collection ${collectionName}`));\n\n      return callback(undefined, doc);\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}